---
phase: 01-critical-fix
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/api/types.ts
  - src/api/client.ts
autonomous: true

must_haves:
  truths:
    - "Session type exists with correct fields (id, workspace_id, created_at, updated_at)"
    - "FollowUpRequest uses prompt field (not message) and includes executor_profile_id"
    - "ApiClient has methods for session operations (listSessions, getSession, sessionFollowUp)"
  artifacts:
    - path: "src/api/types.ts"
      provides: "Session interface and updated FollowUpRequest"
      contains: "interface Session"
    - path: "src/api/client.ts"
      provides: "Session API methods"
      contains: "listSessions"
  key_links:
    - from: "src/api/client.ts"
      to: "src/api/types.ts"
      via: "import Session, FollowUpRequest"
      pattern: "import.*Session.*FollowUpRequest.*from.*types"
---

<objective>
Add Session type definitions and API client methods for session operations.

Purpose: Establish the type foundation and API layer needed for session-based follow-up. The current CLI uses a broken workspace-based follow-up endpoint; the API now requires session-based operations.

Output: Updated types.ts with Session interface and fixed FollowUpRequest, updated client.ts with session methods.
</objective>

<execution_context>
@/home/impactaky/shelffiles/config/claude/get-shit-done/workflows/execute-plan.md
@/home/impactaky/shelffiles/config/claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/01-CONTEXT.md
@.planning/phases/01-critical-fix/01-RESEARCH.md

# Source files to modify
@src/api/types.ts
@src/api/client.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Session type and fix FollowUpRequest in types.ts</name>
  <files>src/api/types.ts</files>
  <action>
Add the Session interface after the Workspace-related types (around line 120). The Session type must match the API response schema using snake_case field names:

```typescript
// Session type for session-based operations
export interface Session {
  id: string;
  workspace_id: string;
  created_at: string;
  updated_at: string;
}
```

Update the existing FollowUpRequest interface (currently at line 195-197) from:
```typescript
export interface FollowUpRequest {
  message: string;
}
```

To:
```typescript
// Follow-up request for sending messages to running sessions
export interface FollowUpRequest {
  prompt: string;
  executor_profile_id: ExecutorProfileID;
}
```

Note: The field is `prompt` not `message` - this matches the current API schema. The ExecutorProfileID type already exists in types.ts.
  </action>
  <verify>
Run `deno check src/api/types.ts` - should complete with no type errors.
Grep for "interface Session" and "prompt: string" in types.ts to confirm changes.
  </verify>
  <done>
Session interface exists with id, workspace_id, created_at, updated_at fields.
FollowUpRequest has prompt and executor_profile_id fields (not message).
  </done>
</task>

<task type="auto">
  <name>Task 2: Add session API client methods to client.ts</name>
  <files>src/api/client.ts</files>
  <action>
First, update the imports at the top of client.ts to include Session (add it to the existing import block from "./types.ts"):

```typescript
import type {
  // ... existing imports ...
  Session,
  // ... rest of imports ...
} from "./types.ts";
```

Then add the following session methods to the ApiClient class. Place them after the existing workspace methods (after line ~306, before the Repository endpoints section):

```typescript
// Session endpoints
listSessions(workspaceId: string): Promise<Session[]> {
  return this.request<Session[]>(`/sessions?workspace_id=${workspaceId}`);
}

getSession(id: string): Promise<Session> {
  return this.request<Session>(`/sessions/${id}`);
}

sessionFollowUp(sessionId: string, request: FollowUpRequest): Promise<void> {
  return this.request<void>(`/sessions/${sessionId}/follow-up`, {
    method: "POST",
    body: JSON.stringify(request),
  });
}
```

Note: Keep the existing `followUp` method (line 288-293) for now - it will be removed when the command is updated in Plan 02.
  </action>
  <verify>
Run `deno check src/api/client.ts` - should complete with no type errors.
Run `deno lint src/api/client.ts` - should pass.
Grep for "listSessions" and "sessionFollowUp" to confirm methods added.
  </verify>
  <done>
ApiClient has listSessions(workspaceId) method that calls /sessions?workspace_id={id}.
ApiClient has getSession(id) method that calls /sessions/{id}.
ApiClient has sessionFollowUp(sessionId, request) method that calls POST /sessions/{id}/follow-up.
  </done>
</task>

</tasks>

<verification>
1. `deno check src/api/types.ts src/api/client.ts` - No type errors
2. `deno lint src/api/` - No lint errors
3. `deno test` - Existing tests still pass (no regressions)
</verification>

<success_criteria>
- Session interface exists in types.ts with correct fields
- FollowUpRequest updated to use prompt + executor_profile_id
- ApiClient has three new methods: listSessions, getSession, sessionFollowUp
- All type checking passes
- No regressions in existing functionality
</success_criteria>

<output>
After completion, create `.planning/phases/01-critical-fix/01-01-SUMMARY.md`
</output>
